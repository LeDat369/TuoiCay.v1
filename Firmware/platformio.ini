; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:nodemcuv2]
platform = espressif8266
board = nodemcuv2
framework = arduino

; Build settings
build_flags = 
    -D LOG_LEVEL=3              ; INFO level logging
    -D ARDUINOJSON_ENABLE_ARDUINO_STRING=1
    -I include                  ; Add include/ to search path for libraries

; Serial / upload settings
monitor_speed = 115200
upload_speed = 460800           ; CH340 compatible speed
upload_port = COM3              ; ESP8266 NodeMCU with CH340

; OTA Update settings (uncomment để enable OTA upload)
; upload_protocol = espota
; upload_port = 192.168.1.100  ; Thay bằng IP của ESP8266 (xem Serial Monitor)
; upload_flags = 
;     --auth=tuoicay123        ; Password từ secrets.h

; Library dependencies
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    knolleary/PubSubClient@^2.8
    ESP8266WiFi
    ESP8266WebServer
    LittleFS
    Ticker
    ArduinoOTA

; LittleFS for web files
board_build.filesystem = littlefs

; Testing configuration
test_framework = unity
test_build_src = no
test_ignore = test_*  ; Skip all for now since no device connected

;=============================================================================
; OTA UPLOAD ENVIRONMENT (dùng sau khi đã nạp qua USB lần đầu)
;=============================================================================
; Cách dùng:
; 1. Build và upload lần đầu qua USB: pio run -e nodemcuv2 --target upload
; 2. Kiểm tra IP của ESP8266 trong Serial Monitor
; 3. Uncomment và sửa upload_port bên dưới
; 4. Upload qua OTA: pio run -e nodemcuv2_ota --target upload

[env:nodemcuv2_ota]
platform = espressif8266
board = nodemcuv2
framework = arduino

; Giữ nguyên build settings
build_flags = 
    -D LOG_LEVEL=3
    -D ARDUINOJSON_ENABLE_ARDUINO_STRING=1
    -I include

lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    knolleary/PubSubClient@^2.8
    ESP8266WiFi
    ESP8266WebServer
    LittleFS
    Ticker
    ArduinoOTA

board_build.filesystem = littlefs
monitor_speed = 115200

; OTA Upload configuration
upload_protocol = espota
upload_port = 192.168.221.39    ; IP từ Serial Monitor
upload_flags = 
    --auth=tuoicay2026           ; Password từ secrets.h

